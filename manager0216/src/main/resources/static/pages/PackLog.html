<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>上传</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../layuiadmin/style/admin.css" media="all">
    <script src="../layuiadmin/layui/layui.js"></script>
    <script src="../layuiadmin/modules/operation.js"></script>
    <script></script>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <!-- 搜索表单 -->
                <div class="layui-form layui-card-header layuiadmin-card-header-auto">
                    <!--         <div class="layui-inline">
                                 <label class="layui-form-label">日志路径</label>
                                 <div class="layui-input-inline" style="width:14rem;">
                                     <select name="logPath" id="logPath">
                                         <option value="">全部</option>
                                         <option value=0>小游戏</option>
                                         <option value=1>小程序</option>
                                         <option value=2>公众号</option>
                                     </select>
                                 </div>
                             </div>-->
                    <div class="layui-inline">
                        <label class="layui-form-label">日志路径</label>
                        <div class="layui-input-inline" style="width: 14rem;">
                            <input type="text" class="layui-input" id="logPath" name="logPath">
                        </div>
                    </div>
                    <br/>
                    <div class="layui-inline">
                        <label class="layui-form-label">查询时间:</label>
                        <div class="layui-input-inline" style="width:14rem;">
                            <input type="text" class="layui-input" id="startTime" name="startTime" placeholder=" - ">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">结束时间:</label>
                        <div class="layui-input-inline" style="width:14rem;">
                            <input type="text" class="layui-input" id="endTime" name="endTime" placeholder=" - ">
                        </div>
                    </div>
                    <br/>
                    <div class="layui-inline">
                        <label class="layui-form-label">查询日期:</label>
                        <div class="layui-input-inline" style="width:14rem;">
                            <input type="text" class="layui-input" id="startDate" name="startDate" placeholder=" - ">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">结束日期:</label>
                        <div class="layui-input-inline" style="width:14rem;">
                            <input type="text" class="layui-input" id="endDate" name="endDate" placeholder=" - ">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <button class="layui-btn layui-btn-sm layui-btn-normal" lay-submit="" lay-filter="search"
                                onclick="submitTime()">
                            <i class="layui-icon layuiadmin-button-btn"></i>打包
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
</script>
<script>
    layui.use(['table', 'laydate', 'form', 'layer'], function () {
        let table = layui.table,
            form = layui.form,
            layer = layui.layer,
            laydate = layui.laydate;
        let $ = layui.$;
        laydate.render({
            elem: '#startTime',
            type: 'datetime',
            format: 'yyyyMMddHH',
            trigger: 'click',
            done: function (value) {
                let startTime = new Date(value).getTime();
                let endTime = new Date($('#endTime').val()).getTime();
                if (endTime < startTime) {
                    layer.msg('结束时间不能小于开始时间');
                    $('#startTime').val($('#endTime').val());
                }
            }
        });
        laydate.render({
            elem: '#endTime',
            type: 'datetime',
            format: 'yyyyMMddHH',
            trigger: 'click',
            done: function (value) {
                let startTime = new Date($('#startTime').val()).getTime();
                let endTime = new Date(value).getTime();
                if (endTime < startTime) {
                    layer.msg('结束时间不能小于开始时间');
                    $('#endTime').val($('#startTime').val());
                }
            }

        });

        laydate.render({
            elem: '#startDate',
            type: 'datetime',
            format: 'yyyyMMdd',
            trigger: 'click',
            done: function (value) {
                let startDate = new Date(value).getTime();
                let endDate = new Date($('#endDate').val()).getTime();
                if (endDate < startDate) {
                    layer.msg('结束日期不能小于开始日期');
                    $('#startDate').val($('#endDate').val());
                }
            }
        });
        laydate.render({
            elem: '#endDate',
            type: 'datetime',
            format: 'yyyyMMdd',
            trigger: 'click',
            done: function (value) {
                let startDate = new Date($('#startDate').val()).getTime();
                let endDate = new Date(value).getTime();
                if (endDate < startDate) {
                    layer.msg('结束时间不能小于开始时间');
                    $('#endDate').val($('#startDate').val());
                }
            }

        });
        form.on('submit(search)', function (data) {

        })
    })

    function submitTime() {
        let $ = layui.$;
        let startTime = $.trim($('#startTime').val());
        let endTime = $.trim($("#endTime").val());
        let startDate = $.trim($('#startDate').val());
        let endDate = $.trim($("#endDate").val());
        let logPath = $("#logPath").val();

        if ((startTime !== "" && endTime === "") || (startTime === "" && endTime !== "")) {
            layer.msg('请把查询时间和结束时时间填写完整', function () {
                time:1500;
            });
            return false;
        }

        if (startTime > endTime) {
            layer.msg('结束时间不能小于开始时间', function () {
                time:1500;
            });
            return false;
        }
        if ((startDate !== "" && endDate === "") || (startDate === "" && endDate !== "")) {
            layer.msg('请把查询日期和结束日期填写完整', function () {
                time:1500;
            });
            return false;
        }
        if (startDate> endDate) {
            layer.msg('结束日期不能小于开始日期', function () {
                time:1500;
            });
            return false;
        }
        if ((startTime != null && startTime !== "") && (startDate != null && startDate !== "")) {
            layer.msg('选择查询时间或者查询日期一个条件', function () {
                time:1500;
            });
            return false;
        }
        $.ajax({
            type: "get",
            dataType: "json",
            url: '../manage/packLog?logPath=' + encodeURIComponent(logPath) + "&startTime=" + startTime
                + "&endTime=" + endTime + "&startDate=" + startDate + "&endDate=" + endDate,
            success: (res) => {
            },
            error: function () {
                layer.msg("打包失败，请联系管理员！", {icon: 2});
            }
        });
    }
</script>
</body>
</html>
