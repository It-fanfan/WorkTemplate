<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fish.dao.fourth.mapper.WxDailyVisitTrendMapper">
    <resultMap id="BaseResultMap" type="com.fish.dao.fourth.model.WxDailyVisitTrend">
        <id column="id" property="id" jdbcType="VARCHAR"/>
        <result column="appId" property="appId" jdbcType="VARCHAR"/>
        <result column="refDate" property="refDate" jdbcType="VARCHAR"/>
        <result column="sessionCnt" property="sessionCnt" jdbcType="INTEGER"/>
        <result column="visitPv" property="visitPv" jdbcType="INTEGER"/>
        <result column="visitUv" property="visitUv" jdbcType="INTEGER"/>
        <result column="visitUvNew" property="visitUvNew" jdbcType="INTEGER"/>
        <result column="stayTimeUv" property="stayTimeUv" jdbcType="DOUBLE"/>
        <result column="stayTimeSession" property="stayTimeSession" jdbcType="DOUBLE"/>
        <result column="visitDepth" property="visitDepth" jdbcType="DOUBLE"/>
        <result column="insertTime" property="insertTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
       id , date, appId, adUnitId, adUnitName, clickCount, clickRate,
        ecpm, exposureCount, exposureRate, income, reqSuccCount
    </sql>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT w.id,w.appId, w.sessionCnt, w.visitPv, w.visitUv, w.visitUvNew,
        w.stayTimeUv, w.stayTimeSession, w.visitDepth,insertTime
        <if test="queryType == 'daily'.toString()">
            ,w.refDate AS refDate
            from persie_value.wx_daily_visit_trend w
            where DATE(w.refDate) between #{beginTime} and #{endTime}
        </if>
        <if test="queryType == 'weekly'.toString()">
            ,w.refWeek AS refDate
            from persie_value.wx_weekly_visit_trend w
            where DATE(w.refWeek) between #{beginTime} and #{endTime}
        </if>
        <if test="queryType == 'monthly'.toString()">
            ,w.refMonth AS refDate
            from persie_value.wx_monthly_visit_trend w
            where DATE(w.refMonth) between #{beginTime} and #{endTime}
        </if>
        <if test="appId != null and appId != ''">
            and w.appId = #{appId, jdbcType=VARCHAR}
        </if>
      /*  group by refDate*/
    </select>

    <select id="selectVisitTrend" resultMap="BaseResultMap">
        SELECT w.id,w.appId, w.sessionCnt, w.visitPv, w.visitUv, w.visitUvNew,
        w.stayTimeUv, w.stayTimeSession, w.visitDepth,insertTime ,w.refDate AS refDate
        from persie_value.wx_daily_visit_trend w
        where DATE(w.refDate) between #{beginTime} and #{endTime}
        <if test="appId != null and appId != ''">
            and w.appId = #{appId, jdbcType=VARCHAR}
        </if>
        group by refDate
    </select>
</mapper>