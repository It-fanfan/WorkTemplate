<!DOCTYPE html>
<html lang="chs">
	<head>
		<meta charset="UTF-8">
		<title>新增&活跃</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="stylesheet" href="../layuiadmin/layui/css/layui.css" media="all">
		<link rel="stylesheet" href="../layuiadmin/style/admin.css" media="all">
		<script src="../layuiadmin/layui/layui.js"></script>
		<script src="../layuiadmin/modules/operation.js"></script>
		<style type="text/css">
			.layui-form .layui-table-cell {
				height: auto;
				overflow: visible;
				text-overflow: inherit;
				white-space: normal;
			}
		</style>
	</head>
	<body>
		<div class="layui-fluid">
			<div class="layui-row layui-col-space15">
				<div class="layui-col-md12">
					<div class="layui-card">

						<div class="layui-form layui-card-header layuiadmin-card-header-auto">
							<!-- 搜索表单 -->
							<div class="layui-inline">
								<label class="layui-form-label">查询方式</label>
								<div class="layui-input-block">
									<select id="searchType" name="searchType" lay-filter="search-type" lay-verify="required">
										<option value="day" selected="selected">日期</option>
										<option value="week">周期</option>
										<option value="month">月份</option>
									</select>
								</div>
							</div>
							<form class="layui-form-item" id="search-form">
								<div class="layui-inline">
									<label class="layui-form-label">时间范围</label>
									<div class="layui-input-inline">
										<input type="text" class="layui-input" id="times" name="times" placeholder=" - ">
									</div>
								</div>
								<div class="layui-inline">
									<button class="layui-btn layuiadmin-btn-useradmin" lay-submit="" lay-filter="front-search">
										<i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
									</button>
								</div>
							</form>
						</div>

						<!-- 数据表格 -->
						<div class="layui-card-body">
							<table class="layui-hide" lay-filter="table-page" id="table-page"></table>
						</div>
					</div>
				</div>
			</div>
		</div>
		</div>
		<script type="text/html" id="toolbar">
		</script>
		<script>
			var operatorurl = '../admin/statistics/user';
			layui.use(['table', 'laydate', 'form', 'layer'], () => {
				var $ = layui.jquery,
					table = layui.table,
					form = layui.form,
					layer = layui.layer,
					laydate = layui.laydate;
				let time = laydate.render({
					elem: '#times',
					range: true
				});
				form.on('select(search-type)', (data) => {
					switch (data.value) {
						case 'day':
							{
								$("#times").val("");
								if(time.config.type != "date")
								{
									time.config.type = "date";
									time.config.format = "yyyy/MM/dd";
									time.render("#times");
									laydate.render(time);
								}
								table.render({
									elem: '#table-page',
									autoSort:false,
									url: operatorurl + '?datagrid=day',
									cols: [
										[{
												field: 'newDate',
												width: 120,
												title: '日期',
												sort: true
											},
											{
												field: 'dnu',
												width: 140,
												title: '新增（DNU）',
												sort: true
											},
											{
												field: 'dau',
												width: 140,
												title: '活跃（DAU）',
												sort: true
											},
											{
												field: 'dnu',
												width: 140,
												title: '新增占比（DNU / DAU）',
												templet: (d) => {
													return UIConfig.divideByPercent(d.dnu, d.dau);
												}
											},
											{
												field: 'dau',
												width: 140,
												title: '用户活跃度（DAU / MAU）',
												templet: (d) => {
													return UIConfig.divideByPercent(d.dau, d.mau);
												}
											},
											{
												field: 'dosu',
												width: 160,
												title: '一次会话用户数（DOSU）',
												sort: true
											},
											{
												field: 'serviceTime',
												width: 120,
												title: '日均使用时长',
												sort: true,
												templet: (d) => {
													let times = UIConfig.divideByDecimal(d.serviceTime, d.dau);
													return UIConfig.formatTime(times);
												}
											},
											{
												field: 'pcu',
												width: 180,
												title: '最高同时在线玩家（PCU）',
												sort: true,
												templet:(d)=>{
													return UIConfig.formatNullData(d.pcu);}
											},
											{
												field: 'acu',
												width: 180,
												title: '平均同时在线玩家（ACU）',
												sort: true,
												templet:(d)=>{
													return UIConfig.formatNullData(d.acu);}
											},
										]
									],
									page: true,
									toolbar: '#toolbar',
									defaultToolbar: ['filter', 'exports']
								});
							}
							break;
						case 'week':
							{
								$("#times").val("");
								if(time.config.type != "date")
								{
									time.config.type = "date";
									time.config.format = "yyyy/MM/dd";
									time.render("#times");
									laydate.render(time);
								}
								table.render({
									elem: '#table-page',
									autoSort:false,
									url: operatorurl + '?datagrid=week',
									cols: [
										[{
												field: 'newWeek',
												width: 120,
												title: '周期',
												sort: true,
												templet: (d) => {
													let str =  "第" + (d.newWeek%100).toFixed(0) + "周("+(d.newWeek/100).toFixed(0)+")";
													return str;
												}
											},
											{
												field: 'wnu',
												width: 120,
												title: '新增（WNU）',
												sort: true
											},
											{
												field: 'wau',
												width: 120,
												title: '活跃（WAU）',
												sort: true
											},
											{
												field: 'wnu',
												width: 140,
												title: '新增占比（WNU / WAU）',
												templet: (d) => {
													return UIConfig.divideByPercent(d.wnu, d.wau);
												}
											},
											{
												field: 'wosu',
												width: 120,
												title: '一次会话用户数（WOSU）',
												sort: true
											},
											{
												field: 'serviceTime',
												width: 120,
												title: '周均使用时长',
												sort: true,
												templet: (d) => {
													let times = UIConfig.divideByDecimal(d.serviceTime, d.wau);
													return UIConfig.formatTime(times);
												}
											},
											{
												field: 'pcu',
												width: 120,
												title: '最高同时在线玩家（PCU）',
												sort: true
											},
											{
												field: 'acu',
												width: 120,
												title: '平均同时在线玩家（ACU）',
												sort: true
											}
										]
									],
									page: true,
									toolbar: '#toolbar',
									defaultToolbar: ['filter', 'exports']
								});
							}
							break;
						case 'month':
							{
								$("#times").val("");
								if(time.config.type != "month")
								{
									time.config.type = "month";
									time.config.format = "yyyy/MM";
									time.render("#times");
									laydate.render(time);
								}
								table.render({
									elem: '#table-page',
									autoSort:false,
									url: operatorurl + '?datagrid=month',
									cols: [
										[{
												field: 'newMonth',
												width: 120,
												title: '月份',
												sort: true,
												templet: (d) => {
													let str = (d.newMonth / 100).toFixed(0) + "/" + (d.newMonth % 100).toFixed(0);
													return str;
												}
											},
											{
												field: 'mnu',
												width: 120,
												title: '新增（MNU）',
												sort: true
											},
											{
												field: 'mau',
												width: 120,
												title: '活跃（MAU）',
												sort: true
											},
											{
												field: 'mnu',
												width: 140,
												title: '新增占比（MNU / MAU）',
												templet: (d) => {
													return UIConfig.divideByPercent(d.mnu, d.mau);
												}
											},
											{
												field: 'mosu',
												width: 120,
												title: '一次会话用户数（MOSU）',
												sort: true
											},
											{
												field: 'serviceTime',
												width: 120,
												title: '月均使用时长',
												sort: true,
												templet: (d) => {
													let times = UIConfig.divideByDecimal(d.serviceTime, d.mau);
													return UIConfig.formatTime(times);
												}
											},
											{
												field: 'pcu',
												width: 120,
												title: '最高同时在线玩家（PCU）',
												sort: true
											},
											{
												field: 'acu',
												width: 120,
												title: '平均同时在线玩家（ACU）',
												sort: true
											}
										]
									],
									page: true,
									toolbar: '#toolbar',
									defaultToolbar: ['filter', 'exports']
								});
							}
							break;
						default:
							break;
					}
				});
				$('.layui-form-select dl dd.layui-this').trigger('click');
			})
		</script>
	</body>
</html>
