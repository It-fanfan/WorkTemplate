<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>系统用户管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.5.6/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-xs12 layui-col-md3">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <i class="fa fa-bullhorn icon icon-tip"></i>广告合集列表 ：
                            <span id="currentSelectedId" style="color: red;"></span> -
                            <span id="currentSelectedName" style="color: red;"></span>
                        </div>
                        <div class="layui-card-body layui-text">

                            <!-- 查询表单 -->
                            <form class="layui-form layui-form-pane" action="" id="data-search-form"
                                lay-filter="data-search-form">
                            </form>

                            <!-- Table表头 -->
                            <script type="text/html" id="crudTableBar">
                                <div class="layui-btn-container">
                                    <button class="layui-btn layui-btn-sm layui-btn-normal" lay-event="add"><i class="layui-icon">&#xe654;</i> 新增 </button>
                                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete"><i class="layui-icon">&#xe640;</i> 批量删除 </button>
                                </div>
                            </script>

                            <!-- Table -->
                            <table class="layui-hide" id="crudTableId" lay-filter="crudTableFilter"></table>

                            <!-- 行内按钮 -->
                            <script type="text/html" id="crudRowBar">
                                <a class="layui-btn layui-btn-xs data-count-edit" lay-event="getAdPosition">合集<i class="layui-icon">&#xe65b;</i></a>
                            </script>

                            <!-- 行内表单 -->
                        </div>
                    </div>
                </div>

                <div class="layui-col-xs12 layui-col-md4">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <input type="text" id="addAdPosition" autocomplete="off" style="width:0px;" readonly>
                            <i class="fa fa-bullhorn icon icon-tip"></i>广告位置：
                            <span id="currentSelectedPositionId" style="color: red;"></span> -
                            <span id="currentSelectedPositionName" style="color: red;"></span>
                        </div>
                        <div class="layui-card-body layui-text">
                            <input type="text" id="addAdPosition" autocomplete="off" class="layui-input layui-hide">
                            <!-- Table表头 -->
                            <script type="text/html" id="adPositionTableBar">
                                <div class="layui-btn-container">
                                    <button class="layui-btn layui-btn-sm layui-btn-normal" lay-event="add"><i class="layui-icon">&#xe654;</i> 新增 </button>
                                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete"><i class="layui-icon">&#xe640;</i> 批量删除 </button>
                                </div>
                            </script>
                            <table class="layui-hide" id="adPositionId" lay-filter="adPositionFilter"></table>
                        </div>
                    </div>
                    <div class="layui-card">
                        <div class="layui-card-header"><i class="fa fa-bullhorn icon icon-tip"></i>广告位置策略</div>
                        <div class="layui-card-body layui-text">
                            <!-- 策略表单 -->
                            <form class="layui-form layui-hide" id="strategy-form" lay-filter="strategy-form">
                                <div class="layui-form-item">
                                    <label class="layui-form-label required">策略类型</label>
                                    <div class="layui-input-block">
                                        <select id="strategyIdSelect" lay-filter="strategyIdSelectFilter"
                                            name="strategyId" lay-search="">
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">策略配置</label>
                                    <div class="layui-input-block">
                                        <input type="text" id="strategyValue" lay-filter="strategyValueFilter"
                                            name="strategyValue" placeholder=" 请输入策略配置" value="" class="layui-input"
                                            autocomplete="off">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="layui-col-xs12 layui-col-md5">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <input type="text" id="addAdSpace" autocomplete="off" style="width:0px;" readonly>
                            <i class="fa fa-bullhorn icon icon-tip"></i>广告位：
                            <span id="currentSelectedSpaceId" style="color: red;"></span> -
                            <span id="currentSelectedSpaceName" style="color: red;"></span>
                        </div>
                        <div class="layui-card-body layui-text lay-hide" id="adSpaceDiv">
                            <input type="text" id="addAdSpace" autocomplete="off" class="layui-input layui-hide">
                            <script type="text/html" id="adSpaceTableBar">
                                <div class="layui-btn-container">
                                    <button class="layui-btn layui-btn-sm layui-btn-normal" lay-event="add"><i class="layui-icon">&#xe654;</i> 新增 </button>
                                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete"><i class="layui-icon">&#xe640;</i> 批量删除 </button>
                                </div>
                            </script>
                            <table class="layui-hide" id="adSpaceId" lay-filter="adSpaceFilter"></table>
                        </div>
                    </div>

                    <div class="layui-card-header">
                        <input type="text" id="addAdContent" autocomplete="off" style="width:0px;" readonly>
                        <i class="fa fa-bullhorn icon icon-tip"></i>广告内容</div>
                    <div class="layui-card-body layui-text lay-hide" id="adContentDiv">
                        <script type="text/html" id="adContentTableBar">
                            <div class="layui-btn-container">
                                <button class="layui-btn layui-btn-sm layui-btn-normal" lay-event="add"><i class="layui-icon">&#xe654;</i> 新增 </button>
                                <button class="layui-btn layui-btn-sm data-add-btn" lay-event="saveIndex"><i class="layui-icon layui-icon-ok"></i> 保存序号 </button>
                                <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete"><i class="layui-icon">&#xe640;</i> 批量删除 </button>
                            </div>
                        </script>
                        <table class="layui-hide" id="adContentId" lay-filter="adContentFilter"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑表单 -->
    <form id="crudFormId" class="layui-form layuimini-form layui-hide" lay-filter="crudFormFilter">
        <div class="layui-form-item">
            <label class="layui-form-label required">ID</label>
            <div class="layui-input-block">
                <input type="text" name="id" placeholder="新增成功自动生成" value="" class="layui-input" autocomplete="off"
                    readonly>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">名称</label>
            <div class="layui-input-block">
                <input type="text" name="name" lay-verify="required" lay-reqtext="名称不能为空" placeholder=" 请输入名称" value=""
                    class="layui-input" autocomplete="off">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button id="crudSaveBtnId" class="layui-btn layui-btn-normal layui-hide" lay-submit
                    lay-filter="crudSaveBtnFilter">确认保存</button>
            </div>
        </div>
    </form>

    <script src="../../lib/layui-v2.5.6/layui.js" charset="utf-8"></script>
    <script src="../../js/lay-config.js" charset="utf-8"></script>
    <script src="../../js/lay-util-select.js" charset="utf-8"></script>
    <script>
        // 当前页面所属模块，使用之前请先在lay-config.js中配置
        const currentPage = {
            module: window.module.jj,
            page: 'jj/configAdCombination'
        }
        const currentPageUrl = currentPage.module.server + currentPage.page;

        let $, form, table, layer;
        layui.use(['form', 'table', 'layer', 'tableSelect'], function () {
            $ = layui.jquery, form = layui.form, layer = layui.layer, table = layui.table;
            const tableSelect = layui.tableSelect;

            // 渲染广告合集列表
            table.render({
                elem: '#crudTableId',
                url: currentPageUrl + '/getPage',
                toolbar: '#crudTableBar',
                cols: [[
                    { type: "checkbox", align: "center", fixed: 'left' },
                    { field: 'id', title: 'ID', align: "center", sort: true },
                    { field: 'name', width: 200, title: '名称', edit: 'text' },
                    { field: 'updateTime', width: 140, title: '数据更新时间', align: "center", sort: true },
                    { field: 'operator', title: '操作', minWidth: 90, toolbar: '#crudRowBar', align: "center", fixed: 'right' }
                ]],
                limits: [10, 20, 30, 50, 100],
                limit: 30,
                loading: true,
                page: true,
                event: true,
                size: 'sm',
                height: 'full-160'
            });

            // 监听查询表单搜索操作
            form.on('submit(data-search-btn)', (data) => {
                tableReload(data.field);
                return false;
            });

            // 刷新数据
            function tableReload(data) {
                console.log(data)
                if (data instanceof Object) {
                    data = JSON.stringify(data);
                }
                // 表格重载
                table.reload('crudTableId', {
                    page: {
                        curr: 1
                    },
                    where: {
                        queryData: data
                    }
                });
            }

            // 监听表头toolBar事件
            table.on('toolbar(crudTableFilter)', (obj) => {
                switch (obj.event) {
                    case 'add':
                        edit({}, obj.event, 'POST', '新增');
                        break;
                    case 'delete':
                        const data = table.checkStatus('crudTableId').data, dataLength = data.length;
                        if (dataLength === 0) {
                            layer.msg('批量删除，请至少选择一行！', { icon: 0, time: 2000 });
                        } else {
                            layer.confirm('真的删除选中的' + dataLength + '行么?', (index) => {
                                layer.close(index);
                                let deleteIdArray = [];
                                data.forEach((val, ind, arr) => { deleteIdArray.push(val.id); });
                                $.ajax({
                                    url: currentPageUrl + "/",
                                    type: 'DELETE',
                                    headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                                    data: JSON.stringify(deleteIdArray),
                                    dataType: "json",
                                    async: false,
                                    success: function (result) {
                                        layer.msg(result.msg, { icon: result.code, time: 2000 });
                                        if (result.code === 1) { tableReload(); }
                                    }
                                });
                            });
                        }
                        break;
                    default:
                        break;
                }
            });

            // 监听表格每行的tool操作事件
            table.on('tool(crudTableFilter)', (obj) => {
                switch (obj.event) {
                    case 'getAdPosition':
                        getAdPosition(obj.data);
                        break;
                    default:
                        break;
                }
            });

            //监听单元格编辑
            table.on('edit(crudTableFilter)', function (obj) {
                const value = obj.value, data = obj.data, field = obj.field;
                $.ajax({
                    url: currentPageUrl + '/updateName',
                    data: JSON.stringify({ id: data.id, name: data.name }),
                    headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                    type: 'POST',
                    dataType: "json",
                    async: false,
                    success: function (result) {
                        layer.msg(result.msg, { icon: result.code, time: 2000 });
                    }
                });
            });

            // 新增或者编辑广告合集配置
            function edit(editData, type, methodType, title) {
                $('#crudFormId').removeClass('layui-hide').addClass('layui-show');
                const index = layer.open({
                    type: 1,
                    title: title,
                    maxmin: true,
                    area: ['100%', '100%'],
                    content: $('#crudFormId'),
                    btn: ['确定', '取消'],
                    btnAlign: 'c',
                    success: (layero, index) => {
                        console.log(editData);
                        form.val("crudFormFilter", editData)
                    },
                    yes: () => {
                        // 提交监听
                        form.on('submit(crudSaveBtnFilter)', (submitData) => {
                            console.log('submitData -> ', submitData);
                            $.ajax({
                                url: currentPageUrl,
                                data: JSON.stringify(submitData),
                                headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                                type: methodType,
                                dataType: "json",
                                async: false,
                                success: function (result) {
                                    console.log(methodType, JSON.stringify(result));
                                    layer.msg(result.msg, { icon: result.code, time: 2000 });
                                    if (result.code === 1) {
                                        layer.close(index);
                                        tableReload();
                                    }
                                }
                            });
                        });
                        $('#crudSaveBtnId').trigger('click');
                    },
                    cancle: () => {
                        console.log('cancle?');
                    },
                    end: () => {
                        $("#crudFormId")[0].reset();
                        $('#crudFormId').removeClass('layui-show').addClass('layui-hide');
                    }
                });
                $(window).on("resize", function () {
                    layer.full(index);
                });
            }

            // 点击广告合集名称查询广告位置列表
            function getAdPosition(data) {
                $('#adPositionForm').removeClass('layui-hide').addClass('layui-show');
                $('#adSpaceDiv').removeClass('layui-show').addClass('layui-hide');
                $('#strategy-form').removeClass('layui-show').addClass('layui-hide');
                $('#adContentDiv').removeClass('layui-show').addClass('layui-hide');
                $('#currentSelectedId').html(data.id);
                $('#currentSelectedName').html(data.name);
                $('#currentSelectedPositionId').html('');
                $('#currentSelectedPositionName').html('');
                $('#currentSelectedSpaceId').html('');
                $('#currentSelectedSpaceName').html('');
                $.ajax({
                    url: currentPageUrl + "/getAdPositionList/" + data.id,
                    type: 'GET',
                    dataType: "json",
                    async: false,
                    success: (result) => {
                        table.render({
                            id: 'adPositionId',
                            elem: '#adPositionId',
                            toolbar: '#adPositionTableBar',
                            cols: [[
                                { field: 'aaa', type: "checkbox", width: 50, align: "center" },
                                { field: 'positionId', width: 60, title: 'ID', align: "center", sort: true },
                                { field: 'positionType', width: 200, title: '类型', event: 'getAdSpace', style: 'cursor: pointer;' },
                                { field: 'positionName', width: 208, title: '名称', event: 'getAdSpace', style: 'cursor: pointer;' },
                            ]],
                            data: result,
                            page: false,
                            limit: Number.MAX_VALUE,
                            loading: true,
                            event: true,
                            size: 'sm',
                            height: 'full-300'
                        });
                    },
                    error: (XMLHttpRequest, textStatus) => {
                        layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                    },
                    complete: (XMLHttpRequest, textStatus) => {
                        return false;
                    }
                });
            }

            // 监听广告位置策略配置
            renderNormalSelect('strategyIdSelect', 'jj', 'configAdStrategy', 'windowCache');

            // 监听广告位置表头按钮
            table.on('toolbar(adPositionFilter)', (obj) => {
                if ('add' === obj.event) {
                    $('#addAdPosition').trigger('click');
                } else if ('delete' === obj.event) {
                    const data = table.checkStatus('adPositionId').data;
                    let deletePositionIdArray = [];
                    data.forEach((val, ind, arr) => {
                        deletePositionIdArray.push(val.positionId);
                    });
                    let deleteData = { id: $('#currentSelectedId').html(), deletePositionIdArray: deletePositionIdArray };
                    console.log(deleteData);
                    $.ajax({
                        url: currentPageUrl + "/deleteAdPositions",
                        data: JSON.stringify(deleteData),
                        headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                        type: 'POST',
                        dataType: "json",
                        async: false,
                        success: (result) => {
                            layer.msg(result.msg, { icon: result.code, time: 2000 });
                            if (result.code === 1) {
                                getAdPosition(deleteData);
                            }
                        },
                        error: (XMLHttpRequest, textStatus) => {
                            layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                        },
                        complete: (XMLHttpRequest, textStatus) => {
                            return false;
                        }
                    });
                }
            });

            // 监听策略切换事件
            form.on('select(strategyIdSelectFilter)', function (data) {
                let updateAdStrategyOption = {
                    id: $('#currentSelectedId').html(),
                    positionId: $('#currentSelectedPositionId').html(),
                    strategyId: $('#strategyIdSelect').html(),
                    strategyValue: $('#strategyValue').val()
                };
                updateAdStrategy(updateAdStrategyOption);
            });

            // 监听策略配置输入事件
            $("#strategyValue").change(function (e) {
                const strategyValue = e.delegateTarget.value;
                if (strategyValue) {
                    try {
                        const strategyObject = JSON.parse(strategyValue);
                        if (typeof strategyObject !== 'object' || !strategyObject) {
                            layer.msg('您输入的策略配置不符合Json格式 1，数据不会保存，请重新输入！', { icon: 2, time: 3000 });
                            return false;
                        }
                    } catch (e) {
                        layer.msg('您输入的策略配置不符合Json格式 2，数据不会保存，请重新输入！', { icon: 2, time: 3000 });
                        return false;
                    }
                }
                let updateAdStrategyOption = {
                    id: $('#currentSelectedId').html(),
                    positionId: $('#currentSelectedPositionId').html(),
                    strategyId: $('#currentSelectedId').html(),
                    strategyValue: strategyValue
                };
                updateAdStrategy(updateAdStrategyOption);
            });

            function updateAdStrategy(updateAdStrategyOption) {
                console.log(updateAdStrategyOption)
                $.ajax({
                    url: currentPageUrl + "/updateAdStrategy",
                    data: JSON.stringify(updateAdStrategyOption),
                    headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                    type: 'POST',
                    dataType: "json",
                    async: false,
                    success: (result) => {
                        layer.msg(result.msg, { icon: result.code, time: 2000 });
                    },
                    error: (XMLHttpRequest, textStatus) => {
                        layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                    },
                    complete: (XMLHttpRequest, textStatus) => {
                        return false;
                    }
                });
            }

            // 新增广告位置的渲染
            tableSelect.render({
                elem: '#addAdPosition',
                checkedKey: 'addPositionId',
                searchKey: 'name',
                searchPlaceholder: '暂不支持，功能更新完成进行升级优化',
                height: '400',
                width: '520',
                table: {
                    url: currentPage.module.server + 'jj/configAdPosition/getPage',
                    cols: [[
                        { type: "radio", width: 50, align: "center" },
                        { field: 'id', width: 60, title: 'ID', align: "center", sort: true },
                        { field: 'name', width: 200, title: '名称', style: 'cursor: pointer;' },
                        { field: 'adTypeNames', width: 200, title: '类型', style: 'cursor: pointer;' }
                    ]],
                    limits: [10, 30, 50],
                    limit: 10,
                    loading: true,
                    page: true,
                    event: true,
                    size: 'sm',
                },
                done: (elem, data) => {
                    let addPositionId;
                    layui.each(data.data, (index, item) => {
                        addPositionId = item.id;
                    })
                    const id = $('#currentSelectedId').html();
                    if (id && '0' !== id && addPositionId && '0' !== addPositionId) {
                        const addPositionData = { id: id, positionId: addPositionId };
                        $.ajax({
                            url: currentPageUrl + '/addAdPosition',
                            data: JSON.stringify(addPositionData),
                            headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                            type: 'POST',
                            dataType: "json",
                            async: false,
                            success: (result) => {
                                layer.msg(result.msg, { icon: result.code, time: 2000 });
                                getAdPosition(addPositionData);
                            },
                            error: (XMLHttpRequest, textStatus) => {
                                layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                            },
                            complete: (XMLHttpRequest, textStatus) => {
                                return false;
                            }
                        });
                    }
                }
            });

            // 监听广告位置名称表格点击
            table.on('tool(adPositionFilter)', (obj) => {
                console.log(obj.event);
                if ('getAdSpace' === obj.event) {
                    getAdSpace(obj.data);
                }
            });

            /**
             * 获取广告位列表
             */
            function getAdSpace(data) {
                console.log(data);
                $('#adSpaceDiv').removeClass('layui-hide').addClass('layui-show');
                $('#strategy-form').removeClass('layui-hide').addClass('layui-show');
                $('#adContentDiv').removeClass('layui-show').addClass('layui-hide');
                $('#currentSelectedPositionId').html(data.positionId);
                $('#currentSelectedPositionName').html(data.positionName);
                $('#currentSelectedSpaceId').html('');
                $('#currentSelectedSpaceName').html('');
                $.ajax({
                    url: currentPageUrl + "/getAdSpaceList/" + data.id + "/" + data.positionId,
                    type: 'GET',
                    dataType: "json",
                    async: false,
                    success: (result) => {
                        // 渲染广告位置策略
                        form.val('strategy-form', result);
                        form.render();
                        // 渲染广告位列表
                        table.render({
                            id: 'adSpaceId',
                            elem: '#adSpaceId',
                            toolbar: '#adSpaceTableBar',
                            cols: [[
                                { field: 'aaa', type: "checkbox", width: 50, align: "center" },
                                { field: 'spaceId', width: 60, title: 'ID', align: "center", sort: true },
                                { field: 'spaceType', width: 200, title: '类型', event: 'getAdContent', style: 'cursor: pointer;' },
                                { field: 'spaceName', width: 208, title: '名称', event: 'getAdContent', style: 'cursor: pointer;' },
                            ]],
                            data: result.spaceArray,
                            page: false,
                            limit: Number.MAX_VALUE,
                            loading: true,
                            event: true,
                            size: 'sm',
                        });
                    },
                    error: (XMLHttpRequest, textStatus) => {
                        layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                    },
                    complete: (XMLHttpRequest, textStatus) => {
                        return false;
                    }
                });
            }

            // 监听广告位表头按钮
            table.on('toolbar(adSpaceFilter)', (obj) => {
                if ('add' === obj.event) {
                    $('#addAdSpace').trigger('click');
                } else if ('delete' === obj.event) {
                    const data = table.checkStatus('adSpaceId').data;
                    let deleteSpaceIdArray = [];
                    data.forEach((val, ind, arr) => {
                        deleteSpaceIdArray.push(val.spaceId);
                    });
                    let deleteData = { id: $('#currentSelectedId').html(), positionId: $('#currentSelectedPositionId').html(), deleteSpaceIdArray: deleteSpaceIdArray }
                    $.ajax({
                        url: currentPageUrl + "/deleteAdSpaces",
                        data: JSON.stringify(deleteData),
                        headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                        type: 'POST',
                        dataType: "json",
                        async: false,
                        success: (result) => {
                            layer.msg(result.msg, { icon: result.code, time: 2000 });
                            if (result.code === 1) {
                                deleteData.name = $('#currentSelectedPositionName').html();
                                getAdSpace(deleteData);
                            }
                        },
                        error: (XMLHttpRequest, textStatus) => {
                            layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                        },
                        complete: (XMLHttpRequest, textStatus) => {
                            return false;
                        }
                    });
                }
            });

            // 新增广告位置的渲染
            tableSelect.render({
                elem: '#addAdSpace',
                checkedKey: 'addAdSpace',
                searchKey: 'name',
                searchPlaceholder: '暂不支持，功能更新完成进行升级优化',
                height: '400',
                width: '520',
                table: {
                    url: currentPage.module.server + 'jj/configAdSpace/getPage',
                    cols: [[
                        { type: "radio", width: 50, align: "center" },
                        { field: 'id', width: 60, title: 'ID', align: "center", sort: true },
                        { field: 'name', width: 200, title: '名称', style: 'cursor: pointer;' },
                        { field: 'adTypeName', width: 200, title: '类型', style: 'cursor: pointer;' }
                    ]],
                    limits: [10, 30, 50],
                    limit: 10,
                    loading: true,
                    page: true,
                    event: true,
                    size: 'sm',
                },
                done: (elem, data) => {
                    let addSpaceId;
                    layui.each(data.data, (index, item) => {
                        addSpaceId = item.id;
                    })
                    const id = $('#currentSelectedId').html();
                    const positionId = $('#currentSelectedPositionId').html();
                    if (id && '0' !== id && positionId && '0' !== positionId && addSpaceId && '0' !== addSpaceId) {
                        const addSpaceData = { id: id, positionId: positionId, spaceId: addSpaceId };
                        console.log(addSpaceData);
                        $.ajax({
                            url: currentPageUrl + '/addAdSpace',
                            data: JSON.stringify(addSpaceData),
                            headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                            type: 'POST',
                            dataType: "json",
                            async: false,
                            success: (result) => {
                                layer.msg(result.msg, { icon: result.code, time: 2000 });
                                getAdSpace(addSpaceData);
                            },
                            error: (XMLHttpRequest, textStatus) => {
                                layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                            },
                            complete: (XMLHttpRequest, textStatus) => {
                                return false;
                            }
                        });
                    }
                }
            });

            // 监听广告位表格点击
            table.on('tool(adSpaceFilter)', (obj) => {
                if ('getAdContent' === obj.event) {
                    getAdContent(obj.data);
                }
            });

            // 查询广告内容
            function getAdContent(data) {
                $('#adContentDiv').removeClass('layui-hide').addClass('layui-show');
                $('#currentSelectedSpaceId').html(data.spaceId);
                $('#currentSelectedSpaceName').html(data.spaceName);
                $.ajax({
                    url: currentPageUrl + "/getAdContentList/" + data.id + "/" + data.positionId + "/" + data.spaceId,
                    type: 'GET',
                    dataType: "json",
                    async: false,
                    success: (result) => {
                        table.render({
                            id: 'adContentId',
                            elem: '#adContentId',
                            toolbar: '#adContentTableBar',
                            cols: [[
                                { field: 'aaa', type: "checkbox", width: 50, align: "center" },
                                { field: 'contentId', width: 60, title: 'ID', align: "center" },
                                { field: 'showIndex', width: 60, title: '序号', align: "center", edit: 'text' },
                                { field: 'contentType', width: 148, title: '类型' },
                                { field: 'contentName', width: 200, title: '名称' },
                            ]],
                            data: result,
                            page: false,
                            limit: Number.MAX_VALUE,
                            loading: true,
                            event: true,
                            size: 'sm',
                        });
                    },
                    error: (XMLHttpRequest, textStatus) => {
                        layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                    },
                    complete: (XMLHttpRequest, textStatus) => {
                        return false;
                    }
                });
            }

            // 监听广告内容表头点击事件
            table.on('toolbar(adContentFilter)', (obj) => {
                if ('add' === obj.event) {
                    $('#addAdContent').trigger('click');
                } else if ('saveIndex' === obj.event) {
                    const tableData = layui.table.cache['adContentId'];
                    let contentIndexArray = [];
                    tableData.forEach((val, ind, arr) => {
                        contentIndexArray.push({ contentId: val.contentId, showIndex: val.showIndex });
                    })
                    const showIndexObject = {
                        id: $('#currentSelectedId').html(),
                        positionId: $('#currentSelectedPositionId').html(),
                        spaceId: $('#currentSelectedSpaceId').html(),
                        contentIndexArray: contentIndexArray
                    };
                    $.ajax({
                        url: currentPageUrl + "/saveAdContentIndex",
                        data: JSON.stringify(showIndexObject),
                        headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                        type: 'POST',
                        dataType: "json",
                        async: false,
                        success: (result) => {
                            layer.msg(result.msg, { icon: result.code, time: 2000 });
                            if (result.code === 1) {
                                getAdContent(showIndexObject);
                            }
                        },
                        error: (XMLHttpRequest, textStatus) => {
                            layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                        },
                        complete: (XMLHttpRequest, textStatus) => {
                            return false;
                        }
                    });
                } else if ('delete' === obj.event) {
                    const data = table.checkStatus('adContentId').data;
                    let deleteContentIdArray = [];
                    data.forEach((val, ind, arr) => {
                        deleteContentIdArray.push(val.contentId);
                    });
                    let deleteData = {
                        id: $('#currentSelectedId').html(),
                        positionId: $('#currentSelectedPositionId').html(),
                        spaceId: $('#currentSelectedSpaceId').html(),
                        deleteContentIdArray: deleteContentIdArray
                    }
                    $.ajax({
                        url: currentPageUrl + "/deleteAdContents",
                        data: JSON.stringify(deleteData),
                        headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                        type: 'POST',
                        dataType: "json",
                        async: false,
                        success: (result) => {
                            layer.msg(result.msg, { icon: result.code, time: 2000 });
                            if (result.code === 1) {
                                getAdContent(deleteData);
                            }
                        },
                        error: (XMLHttpRequest, textStatus) => {
                            layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                        },
                        complete: (XMLHttpRequest, textStatus) => {
                            return false;
                        }
                    });
                }
            });

            // 新增广告位置的渲染
            tableSelect.render({
                elem: '#addAdContent',
                checkedKey: 'addAdContent',
                searchKey: 'name',
                searchPlaceholder: '暂不支持，功能更新完成进行升级优化',
                height: '400',
                width: '520',
                table: {
                    url: currentPage.module.server + 'jj/configAdContent/getPage',
                    cols: [[
                        { type: "radio", width: 50, align: "center" },
                        { field: 'id', width: 60, title: 'ID', align: "center", sort: true },
                        { field: 'targetAppName', width: 200, title: '名称', style: 'cursor: pointer;' },
                        { field: 'adTypeName', width: 200, title: '类型', style: 'cursor: pointer;' }
                    ]],
                    limits: [10, 30, 50],
                    limit: 10,
                    loading: true,
                    page: true,
                    event: true,
                    size: 'sm',
                },
                done: (elem, data) => {
                    let addContentIds = [];
                    layui.each(data.data, (index, item) => {
                        addContentIds.push(item.id);
                    })
                    const id = $('#currentSelectedId').html();
                    const positionId = $('#currentSelectedPositionId').html();
                    const spaceId = $('#currentSelectedSpaceId').html();
                    if (id && '0' !== id && positionId && '0' !== positionId && spaceId && '0' !== spaceId && '0' !== addContentIds.length) {
                        const addContentData = { id: id, positionId: positionId, spaceId: spaceId, contentIds: addContentIds };
                        console.log(addContentData);
                        $.ajax({
                            url: currentPageUrl + '/addAdContent',
                            data: JSON.stringify(addContentData),
                            headers: { 'Content-Type': 'application/json;charset=utf8', 'JSESSIONID': window.localStorage.getItem('JSESSIONID') },
                            type: 'POST',
                            dataType: "json",
                            async: false,
                            success: (result) => {
                                layer.msg(result.msg, { icon: result.code, time: 2000 });
                                getAdContent(addContentData);
                            },
                            error: (XMLHttpRequest, textStatus) => {
                                layer.msg('Ajax Error -> 请求服务器异常，请联系管理员！', { icon: 2, time: 2000 });
                            },
                            complete: (XMLHttpRequest, textStatus) => {
                                return false;
                            }
                        });
                    }
                }
            });

            // 监听广告内容行内编辑
            table.on('edit(adContentFilter)', function (obj) {
            });
        });
    </script>

</body>

</html>